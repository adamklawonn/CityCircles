#content.grid_12
  .grid_8#posts.alpha
    #midmap
      #content-spotlight-map
    #post
      #article
      
        %h1
          = @fix_it.headline
        %p
          = "By #{ @fix_it.author.login }"
        %br
        %p
          = @fix_it.body
         
      #comments
        %span
          comments
        .comment
          I hope the demo is going well. :)
          %br
          %br
          = Time.now.strftime( "%m/%d/%y at %I:%M %p " )
          by caiges
        .userimage
          = image_tag "caige.jpg", { :border => 0 }
      .clear
          
  .grid_4#storyside.omega
    #twtr-search-widget
    = javascript_include_tag "http://widgets.twimg.com/j/1/widget.js"
    = stylesheet_link_tag "http://widgets.twimg.com/j/1/widget.css"
    :javascript
      new TWTR.Widget({
        search: '_citycircles OR #citycircles',
        id: 'twtr-search-widget',
        loop: true,
        title: 'City Circles',
        subject: 'twittersphere',
        width: 300,
        height: 302,
        theme: {
          shell: {
            background: '#c7dacd',
            color: '#ffffff'
          },
          tweets: {
            background: '#ffffff',
            color: '#444444',
            links: '#1985b5'
          }
        }
      }).render().start();
    .clear
    #mostread
      %h1
        most recent community projects
      .infoblock
        - FixIt.find( :all, :limit => 9 ).each do |fix_it|
          %h2
            = link_to truncate( fix_it.headline, 30 ), fix_it_url( fix_it )
        %h5
          more>>
      
:javascript

  function loadFixItMap() {
    if ( GBrowserIsCompatible() ) {
      
      // Create news icon.
      fixItIcon = new GIcon();
      fixItAnchor = new GPoint( #{ @fix_it.map_icon.icon_anchor } );
      fixItIcon.image = "#{ @fix_it.map_icon.image_url }";
      fixItIcon.iconAnchor = fixItAnchor;
      fixItIcon.infoWindowMarker = fixItAnchor;
      fixItIcon.iconSize = new GSize( 43, 30 );
      fixItIcon.shadow = "#{ @fix_it.map_icon.shadow_url }";
      fixItIcon.shadowSize = new GSize( 43, 30 );
      
      var fixItMap = new GMap2( $( "content-spotlight-map" ) );
      fixItMap.disableDragging();
      fixItMap.disableDoubleClickZoom();
      fixItMap.disableScrollWheelZoom();
      var fixItMarker = new GMarker( new GLatLng( #{ @fix_it.lat }, #{ @fix_it.lng } ), { icon : fixItIcon } );
      fixItMap.setCenter( new GLatLng( #{ @fix_it.lat }, #{ @fix_it.lng } ), 17 ); 
      fixItMap.addOverlay( fixItMarker );
    }
  }
  
  $j( document ).ready( loadFixItMap );
